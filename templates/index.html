<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stock Price Prediction</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
  </head>
  <body>
    <div class="container mt-5">
      <div class="row">
        <div class="col-12">
          <div class="card shadow-lg border-0 rounded-lg mb-4">
            <div class="card-header bg-primary text-white">
              <h3 class="text-center font-weight-bold my-2">
                Stock Price Prediction
              </h3>
            </div>
            <div class="card-body">
              {% with messages = get_flashed_messages() %} {% if messages %} {%
              for message in messages %}
              <div
                class="alert alert-info alert-dismissible fade show"
                role="alert"
              >
                {{ message }}
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="alert"
                  aria-label="Close"
                ></button>
              </div>
              {% endfor %} {% endif %} {% endwith %}

              <div class="row">
                <div class="col-md-6">
                  <div class="card mb-4">
                    <div class="card-header">
                      <h5>Upload Stock Data</h5>
                    </div>
                    <div class="card-body">
                      <p>
                        Upload a CSV file containing historical stock data with
                        columns: Date and Close.
                      </p>
                      <form
                        action="/upload"
                        method="POST"
                        enctype="multipart/form-data"
                      >
                        <div class="mb-3">
                          <label for="file" class="form-label"
                            >Select CSV File</label
                          >
                          <input
                            class="form-control"
                            type="file"
                            id="file"
                            name="file"
                            accept=".csv"
                            required
                          />
                        </div>
                        <button type="submit" class="btn btn-primary">
                          Upload and Predict
                        </button>
                      </form>
                    </div>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="card">
                    <div class="card-header">
                      <h5>Upload Model</h5>
                    </div>                    <div class="card-body">
                      <p>
                        Select a pre-trained LSTM model from the available models
                      </p>
                      <form id="upload_model_form" action="/upload_model" method="POST">
                        <div class="mb-3">
                          <label for="selected_model" class="form-label"
                            >Available Models</label
                          >
                          <select 
                            class="form-select" 
                            id="selected_model" 
                            name="selected_model" 
                            required
                          >
                            <option value="" disabled {% if not active_model %}selected{% endif %}>Select a model...</option>
                            {% for model_name in available_models %}
                              <option value="{{ model_name }}" {% if model_name == active_model %}selected{% endif %}>{{ model_name }}</option>
                            {% endfor %}
                          </select>
                        </div>
                        <div class="mb-3">
                          <label for="scaler_file" class="form-label"
                            >Scaler (.pkl)
                            <span class="text-muted">(optional)</span></label
                          >
                          <input
                            class="form-control"
                            type="file"
                            id="scaler_file"
                            name="scaler_file"
                            accept=".pkl"
                          />
                          <div class="form-text">
                            If not provided, a default scaler will be created
                            automatically
                          </div>
                        </div>                        <button type="submit" class="btn btn-primary">
                          Apply Selected Model
                        </button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row mt-4">
                <div class="col-12">
                  <div
                    class="alert {% if model_loaded %}alert-success{% else %}alert-warning{% endif %}"
                  >
                    <h5>Model Status</h5>
                    {% if model_loaded %}
                    <p>Model is loaded and ready to use.</p>
                    {% else %}
                    <p>
                      Model not loaded. Please upload a model and scaler using
                      the form above.
                    </p>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
  </body>
</html>